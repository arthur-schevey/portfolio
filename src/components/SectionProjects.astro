---
import { Icon } from "astro-icon/components";
import Section from "../layouts/Section.astro";
import { getCollection, render } from 'astro:content';
import MarkdownPreview from "./MarkdownPreview.astro";
const projects = await getCollection('projects');
projects.sort((a, b) => (a.filePath ?? "").localeCompare(b.filePath ?? ""));
---

<Section title="Projects">
    <ul class="daisy-timeline daisy-timeline-snap-icon max-md:daisy-timeline-compact daisy-timeline-vertical">
        {projects.map(async (project) => {
            const { Content } = await render(project)

            return (
            <li class="daisy-timeline-item">       
                {!project.data.first && <hr />}  {/* <!-- Omit on first iteration --> */}
                <div class="daisy-timeline-end self-start!">
                    {project.data.image && (
                        <div class="aspect-4/3 w-full p-8">
                            <img
                                src={project.data.image.src}
                                alt={project.data.image.alt}
                                class="rounded-lg shadow-md w-full h-full object-cover "
                            />
                        </div>
                    )}
                </div>
                <div class="daisy-timeline-middle">
                    <Icon name="ri:circle-fill" />
                </div>  
                <div class="daisy-timeline-start self-start!">
                    
                    <h3 class="text-lg font-black group/link">
                        <span>
                            {project.data.title} 
                            {project.data.projectLink && 
                            <>
                                @
                                <a class="text-primary" href={project.data.projectLink.url} title="hover title" target="_blank">{project.data.projectLink.text}</a>
                                <Icon name="ri:arrow-up-line" class="inline-block w-4 h-4 ml-1 transition-transform translate-y-px shrink-0 group-hover/link:-translate-y-1 group-hover/link:translate-x-1 group-focus-visible/link:-translate-y-1 group-focus-visible/link:translate-x-1 motion-reduce:transition-none rotate-45" aria-hidden="true"></Icon>
                            </>
                          }
                        </span>
                    </h3>

                    <div class="font-bold">
                        {project.data.subheading}
                    </div>

                    <div class=" flex flex-col gap-4">
                        <MarkdownPreview Content={Content}/>

                        {/* Icons from: https://icon-sets.iconify.design/skill-icons/page-4.html?keyword=skill-icon */}
                        <ul class="flex flex-wrap gap-2" aria-label="Technologies used">
                            {project.data.technologies.map((tech) =>  (
                            <li class="bg-skin-button-accent/20 border-skin-hue/20 text-skin-hue flex gap-1 items-center border-solid border rounded-md px-2 py-0.5 text-xs backdrop-blur-sm">
                                {tech.iconName && <Icon name={tech.iconName} width={16} height={16} />}
                                <span>{tech.title}</span>
                            </li>
                            ))}
                        </ul>
                    </div>
                    
                </div>
                <hr />
            </li>
          )
        }
        
)}
    </ul>

</Section>